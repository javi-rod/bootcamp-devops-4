#IMAGEN BASE DE NODE v20 PARA HACER LA BUILD
FROM node:20 AS builder
#DIRECTORIO DE TRABAJO DENTRO DEL CONTENEDOR
WORKDIR /opt/build
#COPIAMOS TODOS LOS FICHEROS AL DIRECTORIO DE TRABAJO
COPY . .
#INSTALAR DEPENDENCIAS
RUN npm ci
#EJECUTAMOS BUILD
RUN npm run build
#IMAGEN BASE DE NODE v20 PARA HACER LA APP
FROM node:20
#DIRECTORIO DE TRABAJO PARA LA APP
WORKDIR /opt/app
#COPIAMOS EL CONTENIDO GENERADO EN BUILDER
COPY --from=builder /opt/build/dist .
#COPIAMOS DE NUESTRO RAIZ LOS json AL WORKING DIRECTORY
COPY  ./*.json .
#INSTALAR DEPENDENCIAS DE PRODUCCIÃ“N
RUN npm ci --only-production
#INDICAMOS QUE EL PUERTO 5000 ES EL QUE USA LA APP
EXPOSE 5000
#ARRANCAMOS APP
CMD ["node", "app.js"]